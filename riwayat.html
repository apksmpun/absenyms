<!DOCTYPE html>
<html>
  <base target="_top">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <style>
    /* Reset Margin dan Padding */
      * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
          font-family: Arial, sans-serif;
        }
      
        /* Body Style */
        body {
          background-color: #f0f8e2; /* Warna latar belakang hijau muda */
          color: #333; /* Warna teks utama */
          padding: 20px;
        }
      
        /* Header Style */
        h1 {
          text-align: center;
          color: #006400; /* Warna hijau gelap */
          margin-bottom: 20px;
        }
      
        /* Nama Pengguna Aktif */
        .active-user {
          text-align: center;
          font-size: 18px;
          color: #333; /* Warna teks utama */
          margin-bottom: 20px;
        }
      
        /* Tabel Style */
        table {
          width: 100%; /* Lebar tabel penuh untuk mobile */
          table-layout: auto;
          border-collapse: collapse;
          margin-bottom: 60px;
          table-layout: 50px; /* Kolom menyesuaikan lebar dengan isinya */
          font-size: 20px;
       
        }
      
        th, td {
          padding: 5px;
          border: 1px solid #006400; /* Hijau gelap */
          text-align: left;
          white-space: wrap; /* Mencegah teks menjadi terlalu panjang di satu baris */

        }
      
        th {
          background-color: #006400; /* Hijau gelap */
          color: #fff;
        }
      
        td {
          background-color: #fff; /* Putih */
        }
      
        tr:nth-child(even) td {
          background-color: #f9f9f9; /* Warna latar belakang sel */
        }

        @media (max-width: 600px) {
        th, td {
        font-size: 12px; /* Ukuran font lebih kecil untuk layar kecil */
        padding: 5px; /* Padding lebih kecil untuk layar kecil */
    }
}
      
        /* Input dan Dropdown Style */
        input[type="text"], select, input[type="number"] {
          width: 100%;
          padding: 10px;
          margin-bottom: 15px;
          border: 2px solid #006400; /* Hijau gelap */
          border-radius: 5px;
          background-color: #f9f9f9; /* Warna latar belakang input */
          color: #333;
        }
      
        input[type="text"]::placeholder, input[type="number"]::placeholder {
          color: #999;
        }
      
        input[type="text"]:focus, select:focus, input[type="number"]:focus {
          outline: none;
          border-color: #ffd700; /* Kuning */
          box-shadow: 0 0 5px rgba(255, 215, 0, 0.5); /* Efek shadow kuning */
        }
      
        /* Tombol Style */
        button {
          width: 100%;
          padding: 10px;
          background-color: #006400; /* Hijau gelap */
          color: #fff;
          border: none;
          border-radius: 5px;
          cursor: pointer;
          font-size: 16px;
          margin-top: 10px;
        }
      
        button:hover {
          background-color: #ffd700; /* Kuning */
          color: #006400; /* Hijau gelap */
        }
      
      
      
       /* Style untuk menu navigasi */
   .active {
        color: #FFD700; /* Warna emas untuk ikon aktif */
      }
.navbar {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    background: rgb(34, 117, 79);
    display: flex;
    justify-content: space-around;
    align-items: center;
    padding: 2px 0;
    border-radius: 10px 10px 0px 0;
    box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
}

.nav-item {
    text-align: center;
    color: white;
    text-decoration: none;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    flex: 1;
    font-size: 11px;
}

.nav-item i {
    display: block;
    font-size: 25px;
    padding-bottom: 5px;
}

.center {
    position: relative;
    top: -18px;
}

.center-icon {
    display: flex;
    justify-content: center;
    align-items: center;
}

.diamond {
    background: rgb(34, 117, 79);
    width: 52px;
    height: 52px;
    display: flex;
    justify-content: center;
    align-items: center;
    border-radius: 50%;
    transform: rotate(45deg);
    box-shadow: 5px 5px  rgba(0, 0, 0, 0);
}

.diamond i {
    font-size: 40px;
    color: white;
    transform: rotate(-45deg);

    
}
      
      /* Menyembunyikan kolom nama */
#namaHeader,
.nama {
  display: none; /* Menyembunyikan header dan sel */
}

#activeUser, #searchInput5{
  display: none;
  visibility: hidden;
}

h1 {
    font-family: Arial, Helvetica, sans-serif; /* Menggunakan font yang elegan */
    font-size: 20px; /* Ukuran font besar */
    font-weight: bold; /* Membuat font lebih tebal */
    color: #05421a; /* Warna hijau tua */
    text-align: center; /* Mengatur judul di tengah */
    margin-bottom: 20px; /* Jarak antara judul dan elemen berikutnya */
    padding-bottom: 10px;
    border-bottom: 2px solid #BDB76B; /* Menambahkan garis bawah */
    
    letter-spacing: 1px; /* Memberi jarak antar huruf */
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2); /* Menambahkan bayangan teks */
}

/* Loading screen */
.loading-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      z-index: 9999;
      font-size: 18px;
  
    }

    .loading-screen i {
      font-size: 50px;
      margin-bottom: 20px;
      animation: spin 1s linear infinite;
    }

    .loading-screen img {
    width: 70px; /* Adjust size as needed */
    height: 70px;
    
    
}
/* Menyembunyikan kolom pertama */
#dataTable tr th:first-child, 
#dataTable tr td:first-child {
    display: none;
}

       </style>
  </head>
  <script>

    function showLoading(isLoading) {
      const overlay = document.getElementById('loading-screen');
      overlay.style.display = isLoading ? 'flex' : 'none';
    }


  // Fungsi untuk mengambil data dari API Google Apps Script dan menampilkan di tabel
    async function fetchData() {
     
        const username = localStorage.getItem('username'); // Ambil username dari local storage
        if (!username) {
          window.location.href = 'index.html';
          return;
        }
    
        // Tampilkan nama pengguna yang aktif
        document.getElementById('activeUser').innerText = `User Aktif: ${username}`;
    
        try {
          const response = await fetch(`https://script.google.com/macros/s/AKfycbzh2U3VcCjkBrz1tYt-YK4pKavlFU4Ih_cCKetC71FAVdtGjKoH8ozN9jxbSTGlHM9svw/exec?action=getSheet6Data&username=${username}`); // Ganti dengan URL API kamu
          const data = await response.json();
          displayDataInTable(data);
          
          // Panggil searchTable setelah data dimuat
          searchTable(); // Panggil pencarian berdasarkan username aktif
        } catch (error) {
          console.error('Error fetching data:', error);
        }
      }
    
      // Fungsi untuk menampilkan data di tabel
      function displayDataInTable(data) {
        showLoading(true); // Show loading before fetching data
        const table = document.getElementById('dataTable');
        table.innerHTML = ''; // Bersihkan tabel sebelum mengisi data baru
        data.forEach((row, rowIndex) => {
          const tr = document.createElement('tr');
          row.forEach((cell) => {
            const td = document.createElement(rowIndex === 0 ? 'th' : 'td'); // Gunakan <th> untuk header
            td.textContent = cell;
            tr.appendChild(td);
          });
          table.appendChild(tr);
        });
        showLoading(false); // Hide loading after fetching data
      }
    
      // Fungsi untuk mencari data di tabel
      function searchTable() {
        const username = localStorage.getItem('username'); // Ambil username dari local storage
        const input1 = document.getElementById('searchInput').value.toLowerCase();
        const input2 = document.getElementById('searchInput2').value.toLowerCase();
        const input3 = document.getElementById('searchInput3').value.toLowerCase();
        const input4 = document.getElementById('searchInput4').value.toLowerCase();
        const input5 = document.getElementById('searchInput5').value;
        const table = document.getElementById('dataTable');
        const rows = table.getElementsByTagName('tr');
    
        for (let i = 1; i < rows.length; i++) { // Mulai dari 1 untuk menghindari header
          const cells = rows[i].getElementsByTagName('td');
          let rowVisible = true;
    
          // Cek jika username yang aktif sama dengan yang ditampilkan
          if (cells[0].textContent.toLowerCase() !== username.toLowerCase()) {
            rowVisible = false; // Sembunyikan jika username tidak sesuai
          }
    
          // Cek masing-masing input untuk menentukan visibilitas baris
          if (input1 && !Array.from(cells).some(cell => cell.textContent.toLowerCase().includes(input1))) rowVisible = false;
          if (input2 && !Array.from(cells).some(cell => cell.textContent.toLowerCase().includes(input2))) rowVisible = false;
          if (input3 && !Array.from(cells).some(cell => cell.textContent.toLowerCase().includes(input3))) rowVisible = false;
          if (input4 && !Array.from(cells).some(cell => cell.textContent.toLowerCase().includes(input4))) rowVisible = false;
          if (input5 && !Array.from(cells).some(cell => {
            const dateValue = new Date(cell.textContent);
            return dateValue.getDate() === parseInt(input5);
          })) rowVisible = false;
    
          rows[i].style.display = rowVisible ? '' : 'none'; // Tampilkan atau sembunyikan baris
        }
      }
    
      // Fungsi untuk menangani input dari pengguna dan pencarian
      function handleSearchInput() {
        searchTable(); // Panggil pencarian
      }
    
      // Memuat data saat halaman pertama kali dimuat
      window.onload = fetchData;
    
       // Tambahkan kelas aktif untuk halaman absensi
       document.getElementById('riwayatButton').classList.add('active'); // Menandai halaman Home sebagai aktif
    
       </script>
  <body>
    <h1>Riwayat Kehadiran</h1>

    <div class="loading-screen" id="loading-screen">
      Memuat data ...
</div>

    <!-- Tampilkan nama pengguna aktif -->
    <div id="activeUser" class="active-user"></div>

    <!-- Input pencarian berdasarkan username (disembunyikan) -->
    <input type="text" id="searchInput" style="display: none;" onkeyup="handleSearchInput()" placeholder="Cari data berdasarkan username...">

    <!-- Dropdown bulan -->
    <select id="searchInput2" onchange="handleSearchInput()">
      <option value="">Pilih Bulan...</option>
      <option value="januari">Januari</option>
      <option value="februari">Februari</option>
      <option value="maret">Maret</option>
      <option value="april">April</option>
      <option value="mei">Mei</option>
      <option value="juni">Juni</option>
      <option value="juli">Juli</option>
      <option value="agustus">Agustus</option>
      <option value="september">September</option>
      <option value="oktober">Oktober</option>
      <option value="november">November</option>
      <option value="desember">Desember</option>
    </select>

    <!-- Input tanggal -->
    <input type="number" id="searchInput5" min="1" max="31" onkeyup="handleSearchInput()" placeholder="Cari tanggal (1-31)..." />

    <!-- Dropdown status -->
    <select id="searchInput3" onchange="handleSearchInput()">
      <option value="">Pilih Kehadiran...</option>
      <option value="masuk">Masuk</option>
      <option value="pulang">Pulang</option>
    </select>

    <!-- Dropdown waktu -->
    <select id="searchInput4" onchange="handleSearchInput()">
      <option value="">Pilih Status...</option>
      <option value="tepat waktu">Tepat Waktu</option>
      <option value="terlambat">Terlambat</option>
      <option value="pulang cepat">Pulang Cepat</option>
      <option value="Bukan Jadwal">Bukan Jadwal</option>
    </select>

 
    <table class="table table-bordered table-striped table-hover" id="dataTable" border="1" cellpadding="5px">
  
        <!-- Data akan diisi dengan JavaScript -->
      </tbody>
    </table>
  </div>



  </body>
     <!-- Menu Navigasi, hanya ditampilkan di halaman absensi -->
<div class="navbar hidden" id="navbar">
  <a href="riwayat.html" class="nav-item">
    <i class="fa-solid fa-clock active"></i>
    <span class="active">Data Absen</span>
</a>
<a href="datapengajuan.html" class="nav-item">
    <i class="fas fa-check-to-slot"></i>
    <span>Data Cuti</span>
</a>
<a href="index.html" class="nav-item center">
    <div class="center-icon">
        <div class="diamond">
            <i class="fas fa-circle-plus"></i>
        </div>
    </div>
</a>
<a href="izin.html" class="nav-item">
    <i class="fas fa-folder"></i>
    <span>Cuti</span>
</a>
<a href="pengajuanlembur.html" class="nav-item">
    <i class="fas fa-business-time"></i>
    <span>Lembur</span>
</a>
</div>
</html>
